<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trading Dashboard - Configuration</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="navbar-container">
        <div class="navbar-brand">
          <div class="navbar-logo">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z" fill="white"/>
            </svg>
          </div>
          <span class="navbar-title">Trading Bot Dashboard</span>
        </div>
        <div class="navbar-actions">
          <a href="/connect" target="_blank" class="navbar-btn navbar-btn-zerodha">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V9.03l7-3.11v7.07z"/>
            </svg>
            <span>Zerodha Login</span>
          </a>
          <a href="/logout" class="navbar-btn navbar-btn-logout">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5-5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
            </svg>
            <span>Logout</span>
          </a>
        </div>
      </div>
    </nav>

    <div class="container">
      <!-- Header -->
      <div class="dashboard-header">
        <div class="logo-container">
          <div class="logo">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z" fill="white"/>
            </svg>
          </div>
      <h2>Trading Configuration</h2>
          <p class="subtitle">Manage your automated trading parameters</p>
        </div>
      </div>



      <!-- Configuration Form -->
      <form method="POST" id="configForm">
        <div class="config-grid">
          <!-- Instrument Symbol -->
          <div class="form-group">
            <label for="instrument_symbol">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              Instrument Symbol
              <span class="tooltip">‚ìò
                <span class="tooltiptext">For FUT: BANKNIFTY, NIFTY | For CE/PE: BANKNIFTY or full symbol like BANKNIFTY26JAN50000CE | For EQ: SBIN, RELIANCE</span>
              </span>
            </label>
            <div class="input-wrapper">
        <input
          type="text"
                id="instrument_symbol"
                name="instrument_symbol"
                value="{{ config.instrument_symbol or 'BANKNIFTY' }}"
                placeholder="e.g., BANKNIFTY or BANKNIFTY26JAN50000CE"
                required
                style="text-transform: uppercase;"
              />
              <svg class="input-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
            </div>
          </div>

          <!-- Exchange -->
          <div class="form-group">
            <label for="exchange">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
              </svg>
              Exchange
              <span class="tooltip">‚ìò
                <span class="tooltiptext">NSE (stocks) or NFO (futures/options)</span>
              </span>
            </label>
            <div class="input-wrapper">
              <select
                id="exchange"
                name="exchange"
                required
              >
                <option value="NFO" {{ 'selected' if config.exchange == 'NFO' else '' }}>NFO (Futures & Options)</option>
                <option value="NSE" {{ 'selected' if config.exchange == 'NSE' else '' }}>NSE (Stocks)</option>
              </select>
              <svg class="input-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
              </svg>
            </div>
          </div>

          <!-- Instrument Type -->
          <div class="form-group">
            <label for="instrument_type">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
              </svg>
              Instrument Type
              <span class="tooltip">‚ìò
                <span class="tooltiptext">FUT (Futures), EQ (Equity/Stock), CE (Call), PE (Put)</span>
              </span>
            </label>
            <div class="input-wrapper">
              <select
                id="instrument_type"
                name="instrument_type"
                required
              >
                <option value="FUT" {{ 'selected' if config.instrument_type == 'FUT' else '' }}>FUT (Futures)</option>
                <option value="EQ" {{ 'selected' if config.instrument_type == 'EQ' else '' }}>EQ (Equity/Stock)</option>
                <option value="CE" {{ 'selected' if config.instrument_type == 'CE' else '' }}>CE (Call Option)</option>
                <option value="PE" {{ 'selected' if config.instrument_type == 'PE' else '' }}>PE (Put Option)</option>
              </select>
              <svg class="input-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
              </svg>
            </div>
          </div>

          <!-- High Low Difference -->
          <div class="form-group">
            <label for="high_low_diff">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
              </svg>
              High-Low Difference
              <span class="tooltip">‚ìò
                <span class="tooltiptext">Maximum allowed difference between candle high and low (in points)</span>
              </span>
            </label>
            <div class="input-wrapper">
              <input
                type="number"
                id="high_low_diff"
          name="high_low_diff"
                value="{{ config.high_low_diff or '50' }}"
                placeholder="e.g., 50"
                min="1"
          required
        />
              <svg class="input-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
              </svg>
            </div>
          </div>

          <!-- Target -->
          <div class="form-group">
            <label for="target">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h10v2H7z"/>
              </svg>
              Target Points
              <span class="tooltip">‚ìò
                <span class="tooltiptext">Profit target in points for each trade</span>
              </span>
            </label>
            <div class="input-wrapper">
        <input
                type="number"
                id="target"
                name="target"
                value="{{ config.target or '30' }}"
                placeholder="e.g., 30"
                min="1"
          required
        />
              <svg class="input-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h10v2H7z"/>
              </svg>
            </div>
          </div>

          <!-- Number of Lots -->
          <div class="form-group">
            <label for="lots">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/>
              </svg>
              Number of Lots
              <span class="tooltip">‚ìò
                <span class="tooltiptext">Number of lots to trade per signal</span>
              </span>
            </label>
            <div class="input-wrapper">
        <input
                type="number"
                id="lots"
                name="lots"
                value="{{ config.lots or '1' }}"
                placeholder="e.g., 1"
                min="1"
          required
        />
              <svg class="input-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/>
              </svg>
            </div>
          </div>

          <!-- Lot Size -->
          <div class="form-group">
            <label for="lot_size">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
              </svg>
              Lot Size (Units per Lot)
              <span class="tooltip">‚ìò
                <span class="tooltiptext">Number of units in one lot (e.g., BANKNIFTY=15, NIFTY=25)</span>
              </span>
            </label>
            <div class="input-wrapper">
        <input
                type="number"
                id="lot_size"
                name="lot_size"
                value="{{ config.lot_size or '15' }}"
                placeholder="e.g., 15"
                min="1"
          required
        />
              <svg class="input-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" id="saveBtn">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
          </svg>
          <span>Save Configuration</span>
        </button>
      </form>

      <!-- Live Logs Viewer -->
      <div class="section-divider">
        <div class="logs-header">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div class="stat-icon" style="width: 40px; height: 40px;">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.5 3.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2l-1.5 1.5zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11v14z"/>
                <path d="M9 7h6v2H9zM16 7h2v2h-2zM9 10h6v2H9zM16 10h2v2h-2z"/>
              </svg>
            </div>
            <div>
              <h2 style="margin: 0; font-size: 22px; color: var(--dark);">Live Logs</h2>
              <p style="margin: 0; font-size: 13px; color: var(--gray);">
                Real-time trading bot activity ‚Ä¢ 
                <span id="logStatus" class="status-badge">‚óè</span>
                <span id="logInfo">Loading...</span>
              </p>
            </div>
          </div>
          <button type="button" id="refreshBtn" class="icon-btn" title="Refresh Logs">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
            </svg>
          </button>
        </div>
      </div>

        <div class="logs-container" id="logsContainer">
          <pre id="logsContent" class="logs-content">Loading logs...</pre>
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById('configForm');
      const saveBtn = document.getElementById('saveBtn');
      const btnText = saveBtn.querySelector('span');
      const btnIcon = saveBtn.querySelector('svg');

      // Form submission with loading state
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Show loading state
        btnText.textContent = 'Saving...';
        btnIcon.style.display = 'none';
        saveBtn.insertAdjacentHTML('afterbegin', '<div class="spinner"></div>');
        saveBtn.disabled = true;

        // Submit form
        const formData = new FormData(form);
        fetch('/dashboard', {
          method: 'POST',
          body: formData
        })
        .then(response => {
          if (response.ok) {
            showToast('Configuration Saved', 'Your trading parameters have been updated successfully.', 'success');
            
            // Reset button state
            setTimeout(() => {
              saveBtn.querySelector('.spinner').remove();
              btnIcon.style.display = 'block';
              btnText.textContent = 'Save Configuration';
              saveBtn.disabled = false;
            }, 1000);
          } else {
            throw new Error('Save failed');
          }
        })
        .catch(error => {
          showToast('Error', 'Failed to save configuration. Please try again.', 'error');
          
          // Reset button state
          saveBtn.querySelector('.spinner').remove();
          btnIcon.style.display = 'block';
          btnText.textContent = 'Save Configuration';
          saveBtn.disabled = false;
        });
      });

      // Input validation and real-time feedback
      const inputs = document.querySelectorAll('input[type="number"]');
      inputs.forEach(input => {
        input.addEventListener('input', function() {
          if (this.value < 1) {
            this.style.borderColor = '#ef4444';
          } else {
            this.style.borderColor = '#e5e7eb';
          }
        });
      });

      // Toast notification function
      function showToast(title, message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `
          <div class="toast-icon">
            ${type === 'success' ? `
              <svg viewBox="0 0 24 24" fill="#10b981" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
              </svg>
            ` : `
              <svg viewBox="0 0 24 24" fill="#ef4444" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
              </svg>
            `}
          </div>
          <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
          </div>
          <button class="toast-close" onclick="this.parentElement.remove()">
            <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/>
            </svg>
          </button>
        `;
        document.body.appendChild(toast);
        
        setTimeout(() => {
          toast.style.animation = 'slideInRight 0.3s ease-out reverse';
          setTimeout(() => toast.remove(), 300);
        }, 4000);
      }

      // Show success message if redirected after save
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('saved') === 'true') {
        showToast('Configuration Saved', 'Your trading parameters have been updated successfully.', 'success');
      }

      // ========================================
      // LIVE LOGS VIEWER
      // ========================================
      
      let refreshInterval;
      const logsContent = document.getElementById('logsContent');
      const logsContainer = document.getElementById('logsContainer');
      const logStatus = document.getElementById('logStatus');
      const logInfo = document.getElementById('logInfo');
      const refreshBtn = document.getElementById('refreshBtn');

      // Track if user is scrolling
      let userScrolling = false;
      let scrollTimeout = null;

      logsContainer.addEventListener('scroll', () => {
        // Check if user has scrolled away from bottom
        const isAtBottom = logsContainer.scrollHeight - logsContainer.scrollTop <= logsContainer.clientHeight + 50;
        
        if (!isAtBottom) {
          userScrolling = true;
          // Clear existing timeout
          if (scrollTimeout) clearTimeout(scrollTimeout);
          // Auto-enable scrolling after 10 seconds of no manual scroll
          scrollTimeout = setTimeout(() => {
            userScrolling = false;
          }, 10000);
        } else {
          userScrolling = false;
        }
      });

      // Fetch logs from API
      async function fetchLogs() {
        try {
          const response = await fetch('/api/logs');
          const data = await response.json();
          
          if (data.error) {
            logsContent.textContent = `Error: ${data.error}`;
            logStatus.className = 'status-badge error';
            logInfo.textContent = 'Error loading logs';
            return;
          }

          // Update logs content with syntax highlighting
          logsContent.innerHTML = highlightLogs(data.logs);
          
          // Auto-scroll to bottom ONLY if user hasn't manually scrolled up
          if (!userScrolling) {
            logsContainer.scrollTop = logsContainer.scrollHeight;
          }
          
          // Update status
          logStatus.className = 'status-badge active';
          logInfo.textContent = `Last ${data.lines} lines ‚Ä¢ Total: ${data.total_lines} lines`;
          
          // Update last refresh time
          const now = new Date();
          const timeStr = now.toLocaleTimeString();
          logInfo.textContent += ` ‚Ä¢ Updated: ${timeStr}`;
          
        } catch (error) {
          logsContent.textContent = 'Failed to fetch logs. Make sure the server is running.';
          logStatus.className = 'status-badge error';
          logInfo.textContent = 'Connection error';
        }
      }

      // Refresh button - also forces scroll to bottom
      refreshBtn.addEventListener('click', () => {
        refreshBtn.style.transform = 'rotate(360deg)';
        setTimeout(() => refreshBtn.style.transform = 'rotate(0deg)', 600);
        userScrolling = false; // Force enable auto-scroll
        fetchLogs();
      });

      // Start auto-refresh
      function startAutoRefresh() {
        if (refreshInterval) clearInterval(refreshInterval);
        refreshInterval = setInterval(fetchLogs, 3000); // Refresh every 3 seconds
      }

      // Stop auto-refresh
      function stopAutoRefresh() {
        if (refreshInterval) {
          clearInterval(refreshInterval);
          refreshInterval = null;
        }
      }

      // Initial load with auto-refresh enabled
      fetchLogs();
      startAutoRefresh();

      // Cleanup on page unload
      window.addEventListener('beforeunload', () => {
        stopAutoRefresh();
      });

      // Syntax highlighting for logs
      function highlightLogs(logText) {
        if (!logText) return '';
        
        // Escape HTML
        logText = logText
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
        
        // Highlight log levels with colors
        logText = logText
          // INFO - green
          .replace(/(INFO)/g, '<span style="color: #4ade80; font-weight: 600;">$1</span>')
          // WARNING - yellow
          .replace(/(WARNING|‚ö†)/g, '<span style="color: #fbbf24; font-weight: 600;">$1</span>')
          // ERROR - red
          .replace(/(ERROR|‚úó)/g, '<span style="color: #f87171; font-weight: 600;">$1</span>')
          // SUCCESS markers - bright green
          .replace(/(‚úì|‚úÖ)/g, '<span style="color: #22c55e; font-weight: 700;">$1</span>')
          // Timestamps - gray
          .replace(/(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2},\d{3})/g, '<span style="color: #9ca3af;">$1</span>')
          // Equals lines - dim
          .replace(/(={50,})/g, '<span style="color: #4b5563;">$1</span>')
          // Dashes lines - dim
          .replace(/(-{50,})/g, '<span style="color: #4b5563;">$1</span>')
          // Money amounts - cyan
          .replace(/(‚Çπ[\d,]+\.?\d*)/g, '<span style="color: #22d3ee; font-weight: 600;">$1</span>')
          // Numbers with decimals - cyan
          .replace(/(\d+\.\d+)/g, '<span style="color: #60a5fa;">$1</span>')
          // Emojis - make them stand out
          .replace(/(üìä|üì¶|üîÑ|‚è±Ô∏è|üìÅ|üìß|üîå|üì°|‚è∞|‚è≥|üîç|üìà|üéØ|üí∞|üõë|üìù|üî¥|üìÑ|üìã|üíæ|üìÇ|üö™|üíµ|üíö|‚ù§Ô∏è|üì§|üîî|üìÖ|üíπ|‚¨ÜÔ∏è|‚¨áÔ∏è)/g, '<span style="font-size: 1.1em;">$1</span>')
          // File paths - purple
          .replace(/(\w+\.json|\w+\.txt|\w+\.log|\w+\.py)/g, '<span style="color: #c084fc;">$1</span>')
          // API keys (masked) - dim
          .replace(/([A-Za-z0-9]{8}\.{3})/g, '<span style="color: #6b7280;">$1</span>');
        
        return logText;
      }
    </script>
  </body>
</html>
